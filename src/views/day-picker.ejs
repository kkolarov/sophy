<!DOCTYPE>
<html>
  <head>
    <title>Изберете удобен ден</title>

    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/css/picker/classic.css" />
    <link rel="stylesheet" href="/css/picker/classic.date.css" />

    <style>
      body {
        margin: 0;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>

    <input id="day_picker" class="hidden" type="text" />

    <script type="" src="/vendor/jquery/dist/jquery.min.js"></script>
    <script type="" src="/vendor/pickadate/lib/picker.js"></script>
    <script type="" src="/vendor/pickadate/lib/picker.date.js"></script>

    <script "text/javascript">
      $(document).ready(function() {
        var response = {};
        var fbUserId = 1092096170901736;

        $.ajax({
          url: '/suggestions/' + fbUserId
        })
        .done(function(reservedDays) {
          var days = [];

          for(var i = 0; i < reservedDays.length; ++i) {
            days.push(new Date(reservedDays[i]));
          }

          $('#day_picker').pickadate({
            onSet: function(context) {
              response.text = $('#day_picker').val()

              console.log(response);

              MessengerExtensions.requestCloseBrowser(function success() {
                $.ajax({
                  url: '/predictions',
                  method: 'POST',
                  data: response
                });
              });
            },
            monthsFull: ['Януари', 'Февруари', 'Март', 'Април', 'Май', 'Юни', 'Юли', 'Август', 'Септември', 'Октомври', 'Ноември', 'Декември'],
            weekdaysShort: ['Нед', 'Пон', 'Вто', 'Сря', 'Чет', 'Пет', 'Съб'],
            today: '',
            clear: '',
            close: '',
            format: 'mm/dd/yyyy',
            disable: days
          });

          $('#day_picker').click();
        })
        .fail(function(err) {

        });

        // window.extAsyncInit = function() {
        //   MessengerExtensions.getUserID(function success(uids) {
        //     var psid = uids.psid;
        //     $('#day_picker').pickadate({
        //       onSet: function(context) {
        //         console.log(context);
        //
        //         response.text = $('#day_picker').val()
        //
        //         console.log(response);
        //
        //         MessengerExtensions.requestCloseBrowser(function success() {
        //           $.ajax({
        //             method: 'POST',
        //             url: '/api/oracle/predict',
        //             data: response
        //           });
        //         }).done(function(res) {
        //           console.log(res);
        //         }).fail(function(err) {
        //           console.log(err);
        //         });
        //       },
        //       monthsFull: ['Януари', 'Февруари', 'Март', 'Април', 'Май', 'Юни', 'Юли', 'Август', 'Септември', 'Октомври', 'Ноември', 'Декември'],
        //       weekdaysShort: ['Нед', 'Пон', 'Вто', 'Сря', 'Чет', 'Пет', 'Съб'],
        //       today: '',
        //       clear: '',
        //       close: '',
        //       format: 'mm/dd/yyyy',
        //       disable: [
        //         { from: new Date('12/01/2016'), to: new Date('12/20/2016') }
        //       ]
        //     });
        //
        //     $('#day_picker').click();
        //     response.clientId = psid;
        //   }, function error(err) {
        //
        //   });
        // };
      }
    );

    </script>

    <script>
    (function(d, s, id){
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'Messenger'));
    </script>
  </body>
</html>
